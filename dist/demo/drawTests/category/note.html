<style>
  body {
    color: hsl(280, 8%, 15%);
    background: hsl(42, 55%, 94%);
    font-family: sans-serif;
    font-size: 16px;
    max-width: 700px;
    margin: 20px auto;
  }
  pre {
    font-family: "fira code";
    white-space: pre-wrap;
  }
</style>

<h1>Relationship-based interactive visuals Note</h1>
elliot evans<br />
nov 4 2023<br />
<svg
  style="display: inline; vertical-align: bottom"
  xmlns="http://www.w3.org/2000/svg"
  direction="ltr"
  width="30"
  height="30"
  viewBox="7814.07 -902.6567990190374 43.53 43.52"
>
  <defs />
  <g transform="matrix(1, 0, 0, 1, 7844.27, -886.2613)" opacity="1">
    <path
      d="M0,0 Q-1.2799,0.8442 -1.7633,1.1905 T-2.6355,1.8461 -3.5249,2.6104 -4.3828,3.4068 -5.051,4.0913 -5.6383,4.7625 -6.1474,5.3695 -6.6002,5.9189 -7.0109,6.4346 -7.428,6.9635 -7.9055,7.5542 -8.3886,8.1492 -8.825,8.6919 -9.2357,9.2153 -9.7483,9.8528 -10.2846,10.4961 -10.7682,11.0607 -11.3545,11.7366 -11.947,12.419 -12.425,12.9732 -12.8335,13.4596 -13.1859,13.8887 -13.4941,14.2751 -13.7737,14.6404 -14.0284,15.0033 -14.2674,15.3831 -14.5001,15.7924 -14.7224,16.227 -14.9301,16.6732 -15.1275,17.1483 -15.3215,17.6529 -15.5115,18.1576 -15.6969,18.6943 -15.8526,19.1961 -15.9626,19.6109 -16.0522,20.0417 -16.1193,20.4358 -16.1559,20.7282 -16.1759,20.9718 -16.1869,21.1889 -16.1928,21.3868 -16.1961,21.5607 -16.1979,21.7034 -16.1988,21.8312 -16.1994,21.9555 -16.1951,22.0801 -16.1769,22.2117 -16.1443,22.3471 -16.1015,22.4868 -16.0463,22.629 -15.9504,22.8087 -15.8027,23.0385 -15.6517,23.2593 -15.4694,23.5047 -15.27,23.759 -15.1043,23.9569 -14.948,24.1149 -14.8105,24.2375 -14.6991,24.3339 -14.5974,24.4093 -14.4715,24.4732 -14.3074,24.5375 -14.1157,24.6022 -13.8816,24.6602 -13.5859,24.7123 -13.2383,24.7703 -12.8578,24.8291 -12.3936,24.8885 -11.8087,24.955 -11.2533,25.0117 -10.8297,25.0541 -10.4667,25.0863 -10.1119,25.1061 -9.7706,25.117 -9.4504,25.1229 -9.1325,25.1261 -8.8205,25.1279 -8.532,25.1288 -8.2452,25.1294 -7.9523,25.1297 -7.6449,25.1298 -7.3091,25.1299 -6.9759,25.1231 -6.6442,25.0877 -6.2973,25.0093 -5.8447,24.8326 -5.2729,24.5137 -4.7587,24.1648 -4.2714,23.7973 -3.8033,23.4241 -3.4228,23.1022 -3.0947,22.8039 -2.8225,22.5525 -2.599,22.3449 -2.4179,22.1634 -2.2486,21.9848 -2.0677,21.7943 -1.8827,21.5972 -1.6976,21.3851 -1.4831,21.1241 -1.2116,20.7886 -0.9091,20.3989 -0.5986,19.9569 -0.311,19.5226 -0.0677,19.1538 0.14,18.8275 0.31,18.545 0.45,18.3135 0.55,18.1326 0.63,17.9907 0.68,17.886 0.72,17.8107 0.74,17.7536 0.76,17.7043 0.78,17.6479 0.79,17.5785 0.80,17.4907 0.82,17.3633 0.84,17.1916 0.87,16.9912 0.90,16.7455 0.94,16.4548 0.99,16.1077 1.06,15.7025 1.12,15.3337 1.18,14.9689 1.23,14.5768 1.27,14.2015 1.32,13.8332 1.38,13.4664 1.45,13.0958 1.52,12.7256 1.59,12.344 1.66,11.9496 1.74,11.5413 1.82,11.1322 1.90,10.7613 1.98,10.4407 2.06,10.1318 2.15,9.8201 2.24,9.55 2.32,9.2799 2.39,9.0076 2.45,8.7704 2.51,8.5342 2.55,8.2986 2.60,8.0564 2.66,7.8197 2.71,7.6179 2.75,7.4373 2.79,7.2638 2.83,7.11 2.85,6.9761 2.87,6.8621 2.89,6.7727 2.91,6.7034 2.92,6.6406 2.92,6.5563 2.92,6.4513 2.93,6.3055 2.94,6.1237 2.96,5.9405 2.97,5.7451 2.98,5.5249 3.01,5.2935 3.05,5.0672 3.08,4.8302 3.11,4.5759 3.15,4.3168 3.18,4.08 3.21,3.8848 3.22,3.7351 3.24,3.6284 3.25,3.5452 3.26,3.477 3.27,3.4239 3.27,3.3472 3.27,3.2464 3.28,3.1436 3.30,3.0194 3.32,2.8699 3.32,2.7156 3.33,2.5769 3.33,2.4558 3.33,2.342 3.33,2.2321 3.33,2.1313 3.33,2.0399 3.33,1.956 3.33,1.8784 3.34,1.7974 3.34,1.7169 3.34,1.6116 3.34,1.4657 3.34,1.3178 3.34,1.1622 3.33,1.0001 3.31,0.848 3.27,0.715 3.24,0.6174 3.21,0.5369 3.17,0.4589 3.13,0.3845 3.09,0.3144 3.04,0.2557 3.00,0.2077 2.95,0.1634 2.90,0.121 2.83,0.0729 2.77,0.0216 2.70,-0.0245 2.63,-0.0678 2.57,-0.1074 2.52,-0.1404 2.47,-0.1674 2.42,-0.1936 2.36,-0.2192 2.30,-0.2422 2.26,-0.2639 2.21,-0.2826 2.16,-0.2996 2.11,-0.3202 2.04,-0.3451 1.97,-0.3655 1.90,-0.3766 1.82,-0.3827 1.72,-0.3883 1.59,-0.3936 1.24,-0.392 0.65,-0.3842 L0.33,-0.38 "
      stroke="#c9863e"
      fill="none"
      stroke-linecap="round"
      stroke-width="2"
      stroke-dasharray="none"
      stroke-dashoffset="0"
    />
  </g>
  <g transform="matrix(1, 0, 0, 1, 7834.15, -866.4742)" opacity="1">
    <path
      d="M0,0 Q0.6854,0 0.91,0 T1.343,-0.0136 1.69,-0.0392 2.03,-0.0963 2.37,-0.1819 2.66,-0.2605 2.92,-0.3397 3.14,-0.4238 3.37,-0.5151 3.61,-0.6217 3.87,-0.7526 4.14,-0.908 4.46,-1.1154 4.79,-1.3467 5.15,-1.6024 5.50,-1.8782 5.79,-2.1195 6.03,-2.3285 6.23,-2.5312 6.42,-2.7462 6.58,-2.9431 6.71,-3.121 6.84,-3.3089 6.97,-3.5159 7.10,-3.7356 7.23,-3.9645 7.35,-4.1985 7.47,-4.4443 7.60,-4.7169 7.77,-5.1041 7.95,-5.5539 8.10,-5.9651 8.24,-6.3622 8.38,-6.7334 8.50,-7.0768 8.60,-7.3982 8.70,-7.6941 8.79,-7.96 8.87,-8.1983 8.94,-8.4101 9.00,-8.612 9.06,-8.8131 9.12,-9.0091 9.16,-9.2047 9.19,-9.4 9.22,-9.5929 9.25,-9.7822 9.27,-9.965 9.29,-10.1829 9.31,-10.4244 9.34,-10.7242 9.40,-11.276 9.49,-12.0806 L9.54,-12.52 "
      stroke="#c9863e"
      fill="none"
      stroke-linecap="round"
      stroke-width="2"
      stroke-dasharray="none"
      stroke-dashoffset="0"
    />
  </g>
</svg>
<span style="color: #c9863e"
  >This is a seed note, it is the incomplete start of a note. It is missing
  interactivity, diagrams, content, and editing. With some sunlight and water it
  will sprout. Please be patient while this note sprouts</span
>
<p>
  The deprecated note below was previously too narrow in what it was discussing,
  and not very useful. I think this note will be broken into a few other notes:
</p>
<ul>
  <li>
    "Recursive Drawing" and "ScreenPond" compared
    <ul>
      <li>May also discuss "Patrick's Parabox"</li>
      <li>
        Will conclude with a short discussion of a diagrammatic way to describe
        an essence of these projects
      </li>
    </ul>
  </li>
  <li>
    A diagrammatic language for interactive recursive graphics
    <ul>
      <li>
        Will discuss a way to specify and evaluate recursive systems via
        diagrams
      </li>
      <li>May also discuss a bidirectional variation</li>
      <li>May also dicuss a continuous/smooth variation</li>
      <li>
        May attempt to present a formalism of a "free" category equipped with a
        functor to a transformation category specified using a commutative
        diagram...<br /><br />Why formalize it? Because I am learning Agda with
        Conal Elliott, and I would like to learn to prove things about a system
        I am building!<br /><br />
        I previously hinted that the formalization was based around setoids;
        <a href="https://x.com/qualmist/status/1723895168259227657"
          >Josh Horowitz pointed out that the concept of setoid may not capture
          the essential structure I am trying to formalize</a
        >. This helped me realize this is really about commutative diagrams that
        specify free categories which in the bidirectional case are setoids.
      </li>
    </ul>
  </li>
  <li>Maybe other things?</li>
</ul>
<h2>DEPRECATED NOTE FOLLOWS:</h2>
<p>
  This is an interactive note about a relationship-based API for making visual
  interactive stuff. By relationship-based I mean that the API is made for
  building relationships between visual things. By API I mean JavaScript /
  TypeScript library.
</p>
<h2>Relationships instead of properties</h2>
<h3>my square</h3>
<p>
  In a property-based API for visual stuff, you might create a square like this:
</p>
<pre>
    const mySquare = square({ radius: 20, center: [35,35]})
</pre>
<p>
  See how we initialized the square with a size (radius) and position (center)?
  In the API we will be discussing in this note, nothing has a size nor position
  nor any layout property. So let's make a square without any layout properties:
</p>
<pre>
    const mySquare = square();
</pre>
<h3>square beside square</h3>
<p>
  Things like squares don't have layout properties, they instead have
  <strong>layout relationships</strong> with other things.
</p>
<pre>
    const a = square();
    const b = square();
    besideLeftToRight(a, b);
</pre>
<p>
  There are
  <strong>multiple ways to express the same relationships</strong>; the line
  below is equivalent to the last line above (note that it is "RightToLeft"
  instead of "LeftToRight" and <code>a</code> and <code>b</code> are swapped).
</p>
NOTE: `aLeftOfB` might be better than `besideRightToLeft`
<pre>
    besideRightToLeft(square1, square2);
</pre>
<h3>relating and determining</h3>
<p>
  <code>besideLeftToRight</code> and <code>besideRightToLeft</code> place two
  shapes horizontally next to eachother. Given the position of one of the
  shapes, we can compute the position of the other; in other words, these
  particular relationships <strong>determine</strong> the positions of the
  shapes they relate. For short, I'll say that these relationships determine
  position.
</p>
<p>
  Math warning (feel free to ignore): Formally, these relationships are position
  isomorphisms. Scroll further in this note to see a more formal description of
  all of this.
</p>
<p>Here's a relationship that determines rotation:</p>
<pre>
    const a = square();
    const b = square();
    rotate(Math.PI/8)(a, b);
</pre>
<p>
  To say the same thing again in another situation:
  <code>rotate(Math.PI/8)</code> determines the rotations of the shapes it
  relates.
</p>
<p>
  There are more intense relationships that determine
  <i>all</i> layout properties of the things they relate. The most basic example
  is:
</p>
<pre>
    const a = square();
    const b = square();
    equal(a, b);
</pre>
<p>
  <code>equal</code> completely determines layout of both squares... But it
  might not be the most interesting relationship. Here's another relationship
  that completely determines layout:
</p>
<pre>
    const a = square();
    const b = square();
    equalExceptBesideLeftToRight(a, b);
</pre>
<h3>relationship<u>s</u> (emphasis on the s)</h3>
<p>
  If you have three things, you can relate them all by specifying only two
  relationships.
</p>
<pre>
    const a = square();
    const b = square();
    const c = square();
    besideLeftToRight(a, b);
    besideLeftToRight(b, c);
</pre>
<p>The above is equivalent to the below:</p>
<pre>
    const a = square();
    const b = square();
    const c = square();
    besideLeftToRight(a, b);
    besideLeftToRightWithSomethingInBetween(b)(a, c);
</pre>
THIS NEEDS DIAGRAMS NOT CODE!
<h3>so how do you actually draw stuff</h3>
TODO

<h2>TODO</h2>
- interactive & editable examples<br />
- diagrams<br />
- push and pull and mixed evaluation models<br />
- beyond visuals: bidirectional relationship programming<br />
- more

<h2>Appendix: Formal Description</h2>
TODO. Sneak peek: its a
<a href="https://en.wikipedia.org/wiki/Setoid">Setoid</a>.

<!-- COMMENTS -->

<h2>
  Comments
  <span
    style="
      background: #c9863e;
      color: hsl(42, 55%, 94%);
      padding: 4px;
      font-size: 10px;
      border-radius: 5px;
    "
    >new and simple comments system using val.town, please be kind and don't
    link stuff</span
  >
</h2>
<textarea
  id="commenttext1"
  style="width: 100%; height: 80px"
  placeholder="Hi, I'm [name]. You are a bit wrong about [blank]. I liked [blank]. [blank] didn't make sense, could you clarify? There's a bug!"
></textarea>
<button id="commentbutton1">Submit comment</button>
<div id="commentarea"></div>
<button id="reportbutton">
  Report comments for containing abuse or innapropriate content
</button>
<script>
  function appendComment(str) {
    const div = document.createElement("div");
    div.style.display = "block";
    div.style.margin = "10px 0";
    div.style.background = "white";
    div.style.padding = "10px";
    div.style.borderRadius = "10px";
    div.textContent = str;
    document.getElementById("commentarea").append(div);
  }

  fetch("https://api.val.town/v1/run/vez.getComments2")
    .then((resp) => resp.json())
    .then((comments) => comments.forEach(appendComment));

  const text = document.getElementById("commenttext1");
  const button = document.getElementById("commentbutton1");
  button.addEventListener("click", async () => {
    const value = text.value;

    button.textContent = "🔄";
    fetch(
      "https://api.val.town/v1/run/vez.addComment2?args=" +
        JSON.stringify([value])
    )
      .then((response) => {
        if (response.status >= 400 && response.status < 600) {
          button.textContent =
            "❌ error (sorry theres no details or error reporting yet)";
        } else {
          button.textContent = "✅";
          button.disabled = true;
          text.disabled = true;
          text.value = "";
          appendComment(value);
        }
      })
      .catch(() => {
        button.textContent =
          "❌ error (sorry theres no details or error reporting yet)";
      });
  });
  document
    .getElementById("reportbutton")
    .addEventListener("click", async () => {
      await fetch("https://api.val.town/v1/run/vez.reportComments");
      document.getElementById("reportbutton").disabled = true;
      document.getElementById("reportbutton").textContent =
        "reported to elliot";
    });
</script>
