<!-- #region -->
<style>
  body {
    --main-color: #ca2b6d;
    color: #060a1b;
    background: white;
    font-family: sans-serif;
    font-size: 16px;
    max-width: 700px;
    margin: 20px auto;
  }
  li {
    margin: 10px 0;
  }
  hr {
    margin: 50px 0;
  }
  pre {
    font-family: "fira code";
    white-space: pre-wrap;
  }
  canvas,
  img {
    border-radius: 10px;
  }
  @media (max-width: 700px) {
    body {
      margin: 20px 10px;
    }
  }
</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<h1><a href="../exploring_spaces/">Exploring Spaces</a> 5: ???</h1>
<a href="https://elliot.website">elliot evans<br /></a>
??? 2024<br /><br />

<audio controls>
  <source src="./recording.mp3" type="audio/mpeg" />
  Your browser does not support the audio element.
</audio>
<!-- #endregion -->

<section style="float: left; width: 100%">
  <h2>Circle covers itself 2x</h2>
  <svg
    viewBox="0 -12 400 24"
    width="400"
    class="circle-input"
    style="vertical-align: middle"
  >
    <circle class="draggable x" r="10"></circle>
  </svg>
  <br /><br />
  <span style="font-size: 80px">↠</span>
  <br /><br />
  <svg
    viewBox="0 -12 200 24"
    width="200"
    class="circle-input"
    style="vertical-align: middle"
  >
    <circle class="draggable x" r="10"></circle>
  </svg>
  <script type="module">
    const mod = (a, n, nL = 0) =>
      ((((a - nL) % (n - nL)) + (n - nL)) % (n - nL)) + nL;
    function makeDraggable(state, el) {
      // from https://www.redblobgames.com/making-of/draggable/
      let pos = 0;
      let dragging = null;
      // modified from https://www.redblobgames.com/making-of/draggable/
      function start(event) {
        if (event.button !== 0) return; // left button only
        let { x, y } = state.eventToCoordinates(event);
        dragging = pos - x;
        el.classList.add("dragging");
        // for (const clone of clones) clone.classList.add("dragging");
        el.setPointerCapture(event.pointerId);
      }

      function end(_event) {
        dragging = null;
        el.classList.remove("dragging");
        // for (const clone of clones) clone.classList.remove("dragging");
      }

      function move(event) {
        if (dragging === null) return;
        let { x, y } = state.eventToCoordinates(event);

        const newPos = x + dragging;
        const diff = newPos - pos;
        pos = newPos;
        state.movex(diff);
      }

      el.addEventListener("pointerdown", start);
      el.addEventListener("pointerup", end);
      el.addEventListener("pointercancel", end);
      el.addEventListener("pointermove", move);
      el.addEventListener("touchstart", (e) => e.preventDefault());
    }

    function eventToSvgCoordinates(event, el = event.currentTarget) {
      const svg = el.ownerSVGElement;
      let p = svg.createSVGPoint();
      p.x = event.clientX;
      p.y = event.clientY;
      p = p.matrixTransform(svg.getScreenCTM().inverse());
      return p;
    }

    const makeIt = (el, width, f) => {
      let state = {
        eventToCoordinates: eventToSvgCoordinates,
        dragging: null,
        _x: undefined,
        _pos: undefined,
        get x() {
          return this._x;
        },
        movex(n, shouldSetPos = true) {
          this.setx(this._x + n);

          if (shouldSetPos) {
            try {
              f(n);
            } catch (e) {}
          }
        },
        setx(n) {
          this._x = n;

          el.setAttribute("cx", mod(this._x, 0, width));
        },
      };
      state.setx(20);
      makeDraggable(state, el);
      return state;
    };
    const s1 = makeIt(
      document.getElementsByClassName("draggable")[0],
      400,
      (x) => {
        s2.movex(x, false);
        window.scrub = s1.x;
      }
    );
    const s2 = makeIt(
      document.getElementsByClassName("draggable")[1],
      200,
      (x) => s1.movex(x, false)
    );
  </script>
  <style>
    .circle-input {
      background: #eee;
      border-radius: 10px;
    }
    .circle-inputcircle {
      stroke: black;
      stroke-width: 2px;
    }
    .circle-input.draggable {
      cursor: grab;
      fill: white;
    }
    .circle-input.dragging {
      cursor: grabbing;
      fill: hsl(200, 54%, 76%);
    }
  </style>
</section>

<section style="float: left; width: 100%">
  <h2>Spheres rotations</h2>

  <span style="float: left; margin: 10px">
    <svg
      viewBox="-52 -52 104 104"
      width="200"
      id="dragging3a"
      style="float: left"
    >
      <defs>
        <mask id="hole">
          <rect width="114" height="114" fill="white" x="-62" y="-62" />
          <circle r="50" fill="black" />
        </mask>
      </defs>

      <rect
        id="dragging3a_background_rect"
        width="114"
        height="114"
        fill="white"
        x="-62"
        y="-62"
        mask="url(#hole)"
        style="pointer-events: none"
      />
      <circle cx="0" cy="0" r="50" fill="#eee"></circle>
    </svg>
    <svg
      viewBox="-52 -52 104 104"
      width="200"
      id="dragging3b"
      style="float: left"
    >
      <defs>
        <mask id="hole">
          <rect width="104" height="104" fill="white" x="-52" y="-52" />
          <circle r="50" fill="black" />
        </mask>
      </defs>
      <rect
        id="dragging3b_background_rect"
        width="104"
        height="104"
        fill="white"
        x="-52"
        y="-52"
        mask="url(#hole)"
        style="pointer-events: none"
      />
      <circle cx="0" cy="0" r="50" fill="#eee"></circle>
    </svg>

    <div style="font-size: 80px; clear: left">↓</div>
    <svg
      viewBox="-52 -52 104 104"
      width="200"
      id="dragging2a"
      style="float: left"
    >
      <defs>
        <mask id="hole">
          <rect width="114" height="114" fill="white" x="-62" y="-62" />
          <circle r="50" fill="black" />
        </mask>
      </defs>

      <rect
        id="dragging2a_background_rect"
        width="114"
        height="114"
        fill="white"
        x="-62"
        y="-62"
        mask="url(#hole)"
        style="pointer-events: none"
      />
      <circle cx="0" cy="0" r="50" fill="#eee"></circle>
      <circle
        id="dragging2a_border"
        cx="0"
        cy="0"
        r="50"
        fill="none"
        stroke="black"
        stroke-width="2"
      ></circle>
    </svg>
    <svg
      viewBox="-52 -52 104 104"
      width="200"
      id="dragging2b"
      style="float: left"
    >
      <defs>
        <mask id="hole">
          <rect width="104" height="104" fill="white" x="-52" y="-52" />
          <circle r="50" fill="black" />
        </mask>
      </defs>
      <rect
        id="dragging2b_background_rect"
        width="104"
        height="104"
        fill="white"
        x="-52"
        y="-52"
        mask="url(#hole)"
        style="pointer-events: none"
      />
      <circle cx="0" cy="0" r="50" fill="#eee"></circle>
      <circle
        id="dragging2b_border"
        cx="0"
        cy="0"
        r="50"
        fill="none"
        stroke="black"
        stroke-width="2"
        stroke-dasharray="8"
      ></circle>
    </svg>
    <style>
      svg {
        background: white;
      }
      .draggable {
        stroke: black;
        stroke-width: 2px;
        cursor: grab;
        fill: white;
      }
      .dragging {
        cursor: grabbing;
        fill: hsl(200, 54%, 76%) !important;
      }
    </style>
    <script type="module" src="./draggingSphereUsage.js"></script>
    <div style="font-size: 80px; clear: left">↓</div>
    <svg
      viewBox="-52 -52 104 104"
      width="200"
      id="dragging4a"
      style="float: left"
    >
      <defs>
        <mask id="hole">
          <rect width="114" height="114" fill="white" x="-62" y="-62" />
          <circle r="50" fill="black" />
        </mask>
      </defs>

      <rect
        id="dragging4a_background_rect"
        width="114"
        height="114"
        fill="white"
        x="-62"
        y="-62"
        mask="url(#hole)"
        style="pointer-events: none"
      />
      <circle cx="0" cy="0" r="50" fill="#eee"></circle>
    </svg>
    <svg
      viewBox="-52 -52 104 104"
      width="200"
      id="dragging4b"
      style="float: left"
    >
      <defs>
        <mask id="hole">
          <rect width="104" height="104" fill="white" x="-52" y="-52" />
          <circle r="50" fill="black" />
        </mask>
      </defs>
      <rect
        id="dragging4b_background_rect"
        width="104"
        height="104"
        fill="white"
        x="-52"
        y="-52"
        mask="url(#hole)"
        style="pointer-events: none"
      />
      <circle cx="0" cy="0" r="50" fill="#eee"></circle>
    </svg>
    <style>
      <style > svg {
        background: white;
      }
      .draggable {
        stroke: black;
        stroke-width: 2px;
        cursor: grab;
        fill: white;
      }
      .dragging {
        cursor: grabbing;
        fill: hsl(200, 54%, 76%) !important;
      }
    </style>
    <script type="module" src="./draggingSphereUsage2.js"></script>
  </span>

  <svg
    viewBox="-52 -52 104 104"
    width="200"
    id="dragging1"
    style="float: left; margin-right: 20px; shape-outside: circle(50%)"
  >
    <defs>
      <mask id="hole">
        <rect width="114" height="114" fill="white" x="-62" y="-62" />
        <circle r="50" fill="black" />
      </mask>
    </defs>

    <rect
      id="dragging1_background_rect"
      width="114"
      height="114"
      fill="white"
      x="-62"
      y="-62"
      mask="url(#hole)"
      style="pointer-events: none"
    />
    <circle cx="0" cy="0" r="50" fill="#eee"></circle>
    <circle
      id="dragging1_border"
      cx="0"
      cy="0"
      r="50"
      fill="none"
      stroke="black"
      stroke-width="2"
    ></circle>
  </svg>
  <script type="module" src="./draggingRP2.js"></script>
</section>

<!-- #region -->
<div style="clear: both"></div>
<h2 id="comments">Exploring Spaces Comments</h2>
<textarea
  id="commenttext1"
  style="width: 100%; height: 80px"
  placeholder="Hi, I'm [name]. You are a bit wrong about [blank]. I liked [blank]. [blank] didn't make sense, could you clarify? There's a bug!"
></textarea>
<button id="commentbutton1">Submit comment</button>
<div id="commentarea"></div>
<script type="module">
  const MY_FORKED_VAL_URL = "https://vez-tomatoSalmon.web.val.run/";

  const getComments = async () => {
    const response = await fetch(MY_FORKED_VAL_URL);
    const json = await response.json();
    return json;
  };

  const addComment = async (str) => {
    try {
      const response = await fetch(MY_FORKED_VAL_URL, {
        method: "POST",
        body: JSON.stringify(str),
      });

      if (response.status >= 400 && response.status < 600) {
        /* error */
        return false;
      } else {
        /* success */
        return true;
      }
    } catch (e) {
      /* error */
      return false;
    }
  };

  function appendComment(str) {
    const div = document.createElement("div");
    div.style.display = "block";
    div.style.margin = "10px 0";
    div.style.background = "#eee";
    div.style.padding = "10px";
    div.style.borderRadius = "10px";
    div.textContent = str;
    document.getElementById("commentarea").append(div);
  }

  (await getComments()).forEach(appendComment);

  const text = document.getElementById("commenttext1");
  const button = document.getElementById("commentbutton1");
  button.addEventListener("click", async () => {
    const value = text.value;

    button.textContent = "🔄";
    const success = await addComment(value);
    if (success === false) {
      button.textContent =
        "❌ error (sorry theres no details or error reporting yet)";
    } else {
      button.textContent = "✅";
      button.disabled = true;
      text.disabled = true;
      text.value = "";
      appendComment(value);
    }
  });
</script>
<!-- #endregion -->
